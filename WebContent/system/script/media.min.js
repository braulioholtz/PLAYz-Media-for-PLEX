function Media(){this.PLEX_OPTIONS_PREFIX="plexOptions-",this.PLEX_CURRENT_PREFIX="plexSelected-",this.PLEX_LAST_VIEW_PREFIX="plexLastView-",this.PLEX_CURRENT_PAGE_PREFIX="plexStartView-",this.PLEX_VIEW_MODE="plexViewMode",this.menuBarWidth="60px",this.menuFlag=!1,this.titleScroll,this.viewStart=0,this.viewTotal=0,this.viewCurrent=0,this.viewSize="1"==localStorage.getItem(this.PLEX_OPTIONS_PREFIX+"allItems")?1e6:80}Media.prototype.initialise=function(){var e=this;if(this.plex=new PLEX,this.cache="",this.section=$.querystring().section,this.key=$.querystring().key,this.filter=localStorage.getItem(this.PLEX_LAST_VIEW_PREFIX+this.key)?localStorage.getItem(this.PLEX_LAST_VIEW_PREFIX+this.key):"all",this.filter=$.querystring().filter?$.querystring().filter:this.filter,this.filterKey=$.querystring().filterkey,this.query=$.querystring().query,this.viewStart=parseInt(localStorage.getItem(this.PLEX_CURRENT_PAGE_PREFIX+this.key))||this.viewStart,$("#menu a").tooltipster({position:"right"}),$("#menuFilterView a").tooltipster(),window.NetCastSetPageLoadingIcon&&window.NetCastSetPageLoadingIcon("enabled"),"1"==localStorage.getItem(this.PLEX_OPTIONS_PREFIX+"largeText")&&$("body").addClass("xlarge"),this.debug="1"==localStorage.getItem(this.PLEX_OPTIONS_PREFIX+"debug")?!0:!1,this.debug){var t=document.getElementById("device");html="<table>",html+="<tr><th>Platform</th><td>"+t.platform+"</td></tr>",html+="<tr><th>Chipset</th><td>"+t.chipset+"</td></tr>",html+="<tr><th>HW Version</th><td>"+t.hwVersion+"</td></tr>",html+="<tr><th>SW Version</th><td>"+t.hwVersion+"</td></tr>",html+="<tr><th>SDK Version</th><td>"+t.SDKVersion+"</td></tr>",html+="<tr><th>IP</td><th>"+t.net_ipAddress+"</td></tr>",html+="<tr><th>Language</td><th>"+t.tvLanguage2+"</td></tr>",html+="<tr><th>show hidden files</td><th>"+e.plex.getShouldShowHiddenFiles()+"</td></tr>",window.NetCastGetUsedMemorySize&&(html+='<tr><th>Used Memory</th><td id="debugMemory">'+window.NetCastGetUsedMemorySize()+"</td></tr>"),html+="</table>",$("#debug").html(html),$("#debug").show(),this.setDebug()}switch($(document).keydown(function(t){switch(t.which){case 461:case 27:t.preventDefault(),e.clearDefaults(),history.back(1);break;case 33:case 403:e.plex.panic();break;case 412:e.prevPage();break;case 34:case 406:case 417:e.nextPage()}}),$("#menu a").hover(function(){$(this).focus()}),$("#menu a").keydown(function(t){38==t.which&&$(this).data("keyUp")&&($($(this).data("keyUp")).focus(),t.preventDefault()),40==t.which&&$(this).data("keyDown")&&($($(this).data("keyDown")).focus(),t.preventDefault()),37==t.which&&(e.menuFlag&&$("#menuFilterContent a:first").focus(),t.preventDefault()),39==t.which&&$(this).data("keyRight")&&($($(this).data("keyRight")).focus(),e.menuFlag&&e.hideMenu(),t.preventDefault())}),$.querystring().action){case"view":"channels"==this.section||"playlists"==this.section?$("#filter").hide():this.loadMenu(this.section,this.key),this.view(this.section,this.key,this.filter,this.filterKey,this.viewStart);break;case"search":$("#filter").hide(),this.view(this.section,this.key,"search",this.query,this.viewStart)}},Media.prototype.toggleMenu=function(){this.menuFlag?this.hideMenu():this.showMenu()},Media.prototype.showMenu=function(){$("#menuBar").css("width","270px"),$("#menuFilter").fadeIn(),this.menuFlag=!0,$("#menuFilterContent a:first").focus()},Media.prototype.hideMenu=function(){$("#menuBar").css("width",this.menuBarWidth),$("#menuFilter").hide(),this.menuFlag=!1},Media.prototype.clearDefaults=function(){localStorage.removeItem(self.PLEX_CURRENT_PREFIX+self.key),localStorage.removeItem(this.PLEX_CURRENT_PAGE_PREFIX+this.key)},Media.prototype.nextPage=function(){if(this.viewStart+this.viewSize+1<=this.viewTotal)switch(localStorage.removeItem(self.PLEX_CURRENT_PREFIX+self.key),this.viewStart=this.viewStart+this.viewSize+1,$.querystring().action){case"view":"channels"==this.section||"playlists"==this.section?$("#filter").hide():this.loadMenu(this.section,this.key),this.view(this.section,this.key,this.filter,this.filterKey,this.viewStart);break;case"search":$("#filter").hide(),this.view(this.section,this.key,"search",this.query,this.viewStart)}},Media.prototype.prevPage=function(){if(this.viewStart-this.viewSize-1>=0)switch(localStorage.removeItem(self.PLEX_CURRENT_PREFIX+self.key),this.viewStart=this.viewStart-this.viewSize-1,$.querystring().action){case"view":"channels"==this.section||"playlists"==this.section?$("#filter").hide():this.loadMenu(this.section,this.key),this.view(this.section,this.key,this.filter,this.filterKey,this.viewStart);break;case"search":$("#filter").hide(),this.view(this.section,this.key,"search",this.query,this.viewStart)}},Media.prototype.loadMenu=function(e,t){var i=0,a=this;this.showLoader("Loading"),$("#menuFilterContent ul").empty(),this.plex.getSectionDetails(t,function(e){$("#applicationWallpaper").css("background-image","url("+a.plex.getTranscodedPath($(e).find("MediaContainer:first").attr("art"),1280,720)+")"),$("#menuFilterContent ul").empty(),$("#menuFilterContent ul").append('<li class="heading">Views</li>'),$(e).find("Directory[search!='1'][secondary!='1']").each(function(){html='<li><a href data-key-index="'+i++ +'" data-action="view" data-section="'+a.section+'" data-key="'+a.key+'" data-filter="'+$(this).attr("key")+'">'+$(this).attr("title").replace("By ","")+"</a></li>",$("#menuFilterContent ul").append(html)}),$("#menuFilterContent ul").append('<li class="heading">Filters</li>'),$(e).find("Directory[secondary='1']").each(function(){html='<li><a href data-key-index="'+i++ +'" data-action="view" data-section="'+a.section+'" data-key="'+a.key+'" data-filter="'+$(this).attr("key")+'">'+$(this).attr("title").replace("By ","")+"</a></li>",$("#menuFilterContent ul").append(html)}),$("#menuFilterContent a, #menuFilterView a").hover(function(){$(this).focus()}),$("#menuFilterView a").keydown(function(e){38==e.which&&$(this).data("keyUp")&&($($(this).data("keyUp")).focus(),e.preventDefault()),40==e.which&&$(this).data("keyDown")&&($($(this).data("keyDown")).focus(),e.preventDefault()),37==e.which&&$(this).data("keyLeft")&&($($(this).data("keyLeft")).focus(),e.preventDefault()),39==e.which&&$(this).data("keyRight")&&($($(this).data("keyRight")).focus(),e.preventDefault())}),$("#thumbsView").click(function(){localStorage.setItem(a.PLEX_VIEW_MODE,"thumbs"),a.view(a.section,a.key,a.filter,a.filterKey,a.viewStart),a.hideMenu(),event.preventDefault()}),$("#listView").click(function(){localStorage.setItem(a.PLEX_VIEW_MODE,"list"),a.view(a.section,a.key,a.filter,a.filterKey,a.viewStart),a.hideMenu(),event.preventDefault()}),$("#menuFilterContent a").click(function(e){a.filter=$(this).data("filter"),localStorage.setItem(a.PLEX_LAST_VIEW_PREFIX+$(this).data("key"),$(this).data("filter")),a.clearDefaults(),a.filterKey="",a.view($(this).data("section"),$(this).data("key"),$(this).data("filter"),a.filterKey,0),a.hideMenu(),e.preventDefault()}),$("#menuFilterContent a").keydown(function(e){var t=$(this).data("keyIndex"),i=$(this).parents("#menuFilterContent").find("li a[data-key-index='"+(Number(t)-1)+"']");Number(t)-1<0&&(i=$("#menuFilterView a:first"));var n=$(this).parents("#menuFilterContent").find("li a[data-key-index='"+(Number(t)+1)+"']");38==e.which&&(e.preventDefault(),i.focus()),40==e.which&&(e.preventDefault(),n.focus()),37==e.which&&(e.preventDefault(),a.menuFlag&&(a.hideMenu(),$("#mediaView a:first").focus())),39==e.which&&(e.preventDefault(),$("#filter").focus())})})},Media.prototype.view=function(e,t,i,a,n){this.rowCount=0,this.viewStart=n;var r={start:n,size:this.viewSize},s=this;this.showLoader("Loading"),$("#mediaViewContent ul").empty(),("playlists"==e||"channels"==e)&&(i="all"),s.plex.getSectionMedia(e,t,i,a,function(r){var o=$(r).find("MediaContainer:first");$("#title").stop(!0,!0),$("#title").show(),s.viewTotal=$(r).find("MediaContainer:first").attr("totalSize");var l=Math.ceil(s.viewTotal/s.viewSize),h="<br/>Page "+Math.round(n/s.viewSize+1)+" of "+l;switch(i){case"all":$("#title").html("channels"==e?"Channels":"playlists"==e?"Playlists":o.attr("title2")+h);break;case"search":$("#title").html(a.indexOf("%")>-1?"Search Results"+h:'Results for "'+a+'"'+h);break;default:$("#title").html(o.attr("title1")+" - "+o.attr("title2")+h)}var c=!0;$(r).find("Directory,Video,Photo,Artist,Track,Playlist").each(function(a,n){if(c&&(s.plex.getShouldShowHiddenFiles()||!s.plex.isMarkedAsHidden(n,"title")&&!s.plex.isTreeContainsHiddenFiles(n,i))){var o,l,h,f;switch(h=$(this).attr("thumb"),l=$(this).attr("art"),f=$(this).attr("key"),e){case"playlists":"playlists"==t?(o="playlist",h=$(this).attr("composite"),f=$(this).attr("ratingKey")):o=$(this).attr("type");break;case"channels":o="channels"==t?"channel":$(this).attr("type");break;default:o=$(this).attr("type")}html="list"==localStorage.getItem(s.PLEX_VIEW_MODE)?s.plex.getListHtml(a,s.plex.removeHiddenToken($(this).attr("title")),s.section,o,f,{artist:$(this).attr("parentTitle"),art:l,series:$(this).attr("grandparentTitle"),season:$(this).attr("parentIndex"),episode:$(this).attr("index"),index:$(this).attr("index"),year:$(this).attr("year"),parentKey:$(this).attr("parentKey"),media:$(this).find("Media Part:first").attr("key"),lastViewedAt:$(this).attr("lastViewedAt"),viewOffset:$(this).attr("viewOffset"),viewCount:$(this).attr("viewCount"),leafCount:$(this).attr("leafCount"),viewedLeafCount:$(this).attr("viewedLeafCount"),filter:s.filter,sectionKey:f,section:o}):s.plex.getThumbHtml(a,s.plex.removeHiddenToken($(this).attr("title")),s.section,o,f,{thumb:h,parentThumb:$(this).attr("parentThumb"),grandparentThumb:$(this).attr("grandparentThumb"),art:l,artist:$(this).attr("parentTitle"),series:$(this).attr("grandparentTitle"),season:$(this).attr("parentIndex"),episode:$(this).attr("index"),index:$(this).attr("index"),parentKey:$(this).attr("parentKey"),media:$(this).find("Media Part:first").attr("key"),lastViewedAt:$(this).attr("lastViewedAt"),viewOffset:$(this).attr("viewOffset"),viewCount:$(this).attr("viewCount"),leafCount:$(this).attr("leafCount"),viewedLeafCount:$(this).attr("viewedLeafCount"),filter:s.filter,sectionKey:f,containerArt:$(r).find("MediaContainer:first").attr("art"),containerThumb:$(r).find("MediaContainer:first").attr("thumb"),section:o}),$("#mediaViewContent ul").append(html)}}),$(".thumb").lazyload({placeholder:"system/images/poster.png",container:$("#mediaViewContent")}),$("#title").fadeOut(8e3),s.rowCount=s.getRowCount("#mediaViewContent ul li"),$("#mediaViewContent a").focus(function(){var t=$(this),i=0;localStorage.setItem(s.PLEX_CURRENT_PREFIX+s.key,$(this).data("key")),localStorage.setItem(s.PLEX_CURRENT_PAGE_PREFIX+s.key,s.viewStart),"1"==localStorage.getItem(s.PLEX_OPTIONS_PREFIX+"hoverBackdrop")&&$("#applicationWallpaper").css("background-image","url("+s.plex.getTranscodedPath($(this).data("art"),1280,720)+")"),t.find(".subtitle").length>0&&(clearInterval(s.titleScroll),s.titleScroll=setInterval(function(){t.find(".subtitle").css("textOverflow","clip"),clearInterval(s.titleScroll),s.titleScroll=setInterval(function(){i<=t.find(".subtitle")[0].scrollWidth?t.find(".subtitle").scrollLeft(i+=2):clearInterval(s.titleScroll)},50)},1e3))}),$("#mediaViewContent a").blur(function(){clearInterval(s.titleScroll),$(this).find(".subtitle").scrollLeft(0),$(this).find(".subtitle").css("textOverflow","ellipsis")}),$("#mediaViewContent a").mouseenter(function(){$(this).focus()}),$("#mediaViewContent a").click(function(e){if(e.preventDefault(),s.showLoader("Loading"),$(this).is("[data-filter]"))url="./media.html?action=view&section="+s.section+"&key="+$(this).data("sectionKey")+"&filter="+s.filter+"&filterkey="+encodeURIComponent($(this).data("key"));else switch(s.section){case"playlists":url="playlists"==t?"media.html?action=view&section="+s.section+"&key="+$(this).data("sectionKey"):"./item.html?action=preview&section="+$(this).data("section")+"&sectionKey="+$(this).data("sectionKey")+"&key="+encodeURIComponent($(this).data("key"));break;case"channels":url="channel"!=$(this).data("mediaType")?"./item.html?action=preview&section="+$(this).data("section")+"&sectionKey="+$(this).data("sectionKey")+"&key="+encodeURIComponent($(this).data("key"))+"&debug="+$(this).data("mediaType"):"media.html?action=view&section="+s.section+"&key="+$(this).data("sectionKey")+"&debug="+$(this).data("mediaType");break;default:url="./item.html?action=preview&section="+s.section+"&sectionKey="+$(this).data("sectionKey")+"&key="+encodeURIComponent($(this).data("key"))}$(this).attr("href",url),location.href=url}),$("#mediaViewContent a").keydown(function(e){var t=$(this).data("key-index"),i=Number(t)%s.rowCount==0?$("#back"):$(this).parents("#mediaView").find("li a[data-key-index='"+(Number(t)-1)+"']"),a=$(this).parents("#mediaView").find("li a[data-key-index='"+(Number(t)+1)+"']"),n=$(this).parents("#mediaView").find("li a[data-key-index='"+(Number(t)-s.rowCount)+"']"),r=$(this).parents("#mediaView").find("li a[data-key-index='"+(Number(t)+s.rowCount)+"']");38==e.which&&(e.preventDefault(),n.focus()),40==e.which&&(e.preventDefault(),r.focus()),37==e.which&&(e.preventDefault(),i.focus()),39==e.which&&(e.preventDefault(),a.focus()),(415==e.which||80==e.which)&&(e.preventDefault(),$(this).data("media")&&"undefined"!=$(this).data("media")&&(s.showLoader("Loading"),location.href="player.html?key="+$(this).data("key")+"&autoplay=true"))}),localStorage.getItem(s.PLEX_CURRENT_PREFIX+s.key)&&$("#mediaView li a[data-key='"+localStorage.getItem(s.PLEX_CURRENT_PREFIX+s.key)+"']:first").length>0?$("#mediaView li a[data-key='"+localStorage.getItem(s.PLEX_CURRENT_PREFIX+s.key)+"']:first").focus():$("#mediaView li a").length>0?0==$("#next:focus").length&&0==$("#prev:focus").length&&$("#mediaView li a:first").focus():($("#mediaViewContent ul").html('<p class="centered">Empty view</p'),$("#back").focus()),s.hideLoader()},r)},Media.prototype.showLoader=function(e){$("#message").text(e),$("#loader").show()},Media.prototype.hideLoader=function(){$("#loader").hide()},Media.prototype.getRowCount=function(e){var t=0;return $(e).each(function(){if($(this).prev().length>0){if($(this).position().top!=$(this).prev().position().top)return!1;t++}else t++}),t},Media.prototype.setDebug=function(){{var e=this;document.getElementById("device")}e.debug&&window.NetCastGetUsedMemorySize&&$("#debugMemory").text(window.NetCastGetUsedMemorySize()),timer=setTimeout(function(){e.setDebug()},500)};